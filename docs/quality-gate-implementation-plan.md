# Quality Gate Implementation Plan

This document breaks down the work required to turn the quality gate hook into an enforceable safeguard for mission outputs. Use the status legend below to track progress as the tasks move from design to execution.

**Status Legend**
- `PENDING` – Task scoped, not yet started.
- `STARTED` – Actively in progress.
- `DONE` – Completed and verified.

| Status  | Task | Implementation Notes |
|---------|------|----------------------|
| DONE | **Create default configuration**<br>• Add `config/quality-gate.default.json` describing thresholds and trust weights.<br>• Include keys for `min_sources_per_claim`, `min_trust_score`, `max_unresolved_contradictions`, optional `min_recency_days`, and a `trust_weights` map keyed by `sources[].credibility` labels.<br>• Ensure the file passes `jq .` and documents comments inline (JSON comments via `_comment` strings). | - Leveraged the existing overlay pattern in `config-loader.sh` with defaults such as ≥2 sources and ≥0.6 trust score.<br>- Recency enforcement defaults to 18 months, with `allow_unparsed_dates` toggle for exploratory work.<br>- File validated via `jq .`. |
| DONE | **Document configuration usage**<br>• Update `docs/CONFIGURATION_REFERENCE.md` (quality section) or add a new `docs/QUALITY_GATE.md` entry.<br>• Describe available keys, default thresholds, and override path via `~/.config/cconductor/quality-gate.json`. | - Added a dedicated “Quality Gate” section detailing thresholds, trust weights, and override workflow.<br>- Notes now explain how to relax trust or recency requirements per mission. |
| DONE | **Implement gate logic**<br>• Rewrite `src/claude-runtime/hooks/quality-gate.sh` to load config, inspect the session KG, and emit a detailed verdict.<br>• Accept the session directory as `$1`; fallback to environment for backward compatibility.<br>• Evaluate per-claim source counts, deduplicate by domain + title to gauge independence, sum trust weights, and capture recency by parsing `sources[].date`.<br>• Produce `quality-gate.json` in the session directory summarizing failures and an stderr report for the operator. | - Gate now calculates independent domain count, trust weight sums, confidence, and recency (Python fallback for date parsing).<br>- Writes both a full diagnostic (`artifacts/quality-gate.json`) and compact summary (`artifacts/quality-gate-summary.json`), including remediation suggestions. |
| DONE | **Integrate gate into orchestration**<br>• Call the gate near completion in `src/utils/mission-orchestration.sh` (before `generate_mission_report`).<br>• If the gate fails, set `meta/session.json.status` to `"blocked_quality_gate"`, write a short summary to `report/mission-report.md` explaining the block, and abort finalization gracefully. | - Orchestrator and resume flows now invoke the hook, log pass/warn events, and update `meta/session.json.status` to either `completed` or `completed_with_advisory`.<br>- Final reports always generate; advisory failures surface a banner and quality section instead of aborting. |
| DONE | **Handle resume & retry UX**<br>• Update resume path (`run_mission_orchestration_resume`) to re-run the gate after subsequent iterations.<br>• When a gate block exists, surface the last gate summary to the operator before continuing. | - Resume path shares the same gate runner and status updates; warnings print the summary location rather than failing the run.<br>- Summary files remain in `artifacts/` so dashboards and manual reviews can pick up the diagnostics. |
| DONE | **Add automated tests**<br>• Create `tests/test-quality-gate.sh` that fabricates minimal session directories with stub `knowledge/knowledge-graph.json` files.<br>• Verify pass/fail conditions: single-source claim should fail, dual independent sources should pass, contradiction count above threshold should block.<br>• Ensure the script cleans up temporary directories. | - Test harness fabricates pass/fail sessions, asserts exit codes, and validates the generated reports.<br>- Temporary directories are cleaned via `trap` for repeatable runs. |
| DONE | **Regression & documentation updates**<br>• Run targeted tests plus a smoke run (`./tests/test-cli-parser.sh` or a short mission) and document results in commit notes.<br>• Update `README.md` / `USAGE.md` quality sections to mention the enforced gate and how to resolve failures. | - Executed `tests/test-quality-gate.sh` and `shellcheck` on the new scripts.<br>- README/USAGE now highlight the gate, report path, and override workflow for `quality-gate.json`. |
| STARTED | **Automated quality remediation**<br>• Add a dedicated `quality-remediator` agent that consumes `quality-gate.json` and acquires fresh, independent evidence for failing claims.<br>• Extend `mission-orchestration.sh` to run the gate before finalization, invoke remediation attempts when budget allows, and persist results/attempt counts in `session.json` and `mission-metrics.json`.<br>• Update dashboards/journals/reports to reflect remediation status and provide clear operator messaging when advisories remain. | - Agent metadata and system prompt created; orchestration now loops through `run_quality_assurance_cycle` with budget/attempt safeguards and enriched status logging.<br>- Remaining work: end-to-end validation, dashboard UI tweaks, regression tests, and documentation polish describing the automated remediation flow. |
